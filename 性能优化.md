# 浏览器渲染优化

## 针对js

- script标签放在body标签最后
- 遇到script标签，浏览器会停止渲染，去加载js文件，然后解析
  - async：异步加载，立即解析，渲染的同时下载js文件，下载完毕立即解析
  - defer：异步加载，延迟解析，下载之后等页面渲染完后再解析
- 使用事件委托，减少事件绑定



## 针对css

引入有3种方式link、@import、内联

- link：派发异步http线程去请求加载资源，GUI继续解析
- @import：GUI停止渲染，去加载css文件（一般不采取这种）
- style：GUI直接渲染



## 针对DOM树、CSSDOM树

- 减少html层级、css层级
- 尽量写语义化标签



## 减少回流和重绘

- 尽量修改类名，而不要直接修改元素样式
- 使元素脱离文档流（absolute或fixed），不会对其他元素造成影响
- display：none，操作完毕再设置回来，此种元素不会产生回流、重绘



## 虚拟滚动

- 逻辑：可视区+截取列表部分进行渲染+动态填充空白部分，做到尽量少的渲染DOM
- 空白区域高度计算
  - 上部空白区域高度：startIndex\*每个项的高度，
  - 下部空白区域高度：(总数-endIndex)\*每个项的高度
- 滚动事件节流中的定时器一般采用30ms，防止出现白屏、且滚动事件触发频繁
- 用微信小程序实现的话可以用scroll-view组件充当可视区，滚动事件看其api，设置为上下滚动。

> getBoundingClientReact()获取元素位置，相对于可视化窗口的上下左右

- 快速滑动造成的白屏问题，

  - 渲染性能的问题，可以加防抖解决，不过会有一定的延时

    > 可能是某一组件渲染效率的问题

  - 预留的元素个数太少（应多于可视窗口的高度），前面后面没有可见的元素



# 项目问题

出租车

- 大数据问题，主要想加快响应，但还是解决不了渲染后，页面卡顿的问题，毕竟DOM节点很多

  - 高德地图渲染使用分组渲染，边加载边渲染

    - 核心：Promise，链式调用，可以改用requestAnimationFrame

  - echarts

    - 降采样 sampling
    - 分片加载数据和增量渲染appendData（待定）

    > 目前支持：ECharts 基础版本的 散点图（scatter） 和线图（lines）。ECharts GL 的 散点图（scatterGL）、线图（linesGL） 和可视化建筑群（polygons3D）

